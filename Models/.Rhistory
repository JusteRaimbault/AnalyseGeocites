#   row = sample(nrow(pot),1)
#   center = matrix(pot[row,],nrow=1)
# }
center = matrix(runif(2,min=1,max=gridSize),nrow=1)
# add kernel : use kernlab laplace kernel or other
#if(kernel_type=="poisson"){ker=laplacedot(sigma=1/r_i)}
#if(kernel_type=="gaussian"){ker=rbfdot(sigma=1/(2*r_i^2))}
#if(kernel_type="quadratic"){ker=} # is quad kernel available ?
grid = grid + (d_i * matrix(kernelMatrix(kernel=laplacedot(sigma=1/r_i),x=coords,y=center),nrow=gridSize))
}
if(proba==TRUE){grid = grid / sum(grid)}
return(grid)
}
test = spatializedExpMixtureDensity(50,10,0.7,0.05)
test = spatializedExpMixtureDensity(100,10,0.7,0.05)
test = spatializedExpMixtureDensity(100,10,0.7,0.01)
persp3D(z=test)
test = spatializedExpMixtureDensity(50,10,0.7,0.01)
persp3D(z=test)
test = spatializedExpMixtureDensity(50,10,0.7,0.01)
persp3D(z=test)
test = spatializedExpMixtureDensity(50,10,0.7,0.005)
persp3D(z=test)
dir.create(cldatadir)
cldatadir = paste0(Sys.getenv('CS_DATA'),'/EnergyPrice/Data/raw/cleandata_20170320/')
locfile = paste0(Sys.getenv('CS_HOME'),'/EnergyPrice/Models/DataCollection/loc/adresses_20170320.csv')
dir.create(cldatadir)
setenv('CS_DATA'='/Volumes/Data/ComplexSystems')
Sys.setenv('CS_DATA'='/Volumes/Data/ComplexSystems')
datadir = paste0(Sys.getenv('CS_DATA'),'/EnergyPrice/Data/raw/data_20170320/')
cldatadir = paste0(Sys.getenv('CS_DATA'),'/EnergyPrice/Data/raw/cleandata_20170320/')
locfile = paste0(Sys.getenv('CS_HOME'),'/EnergyPrice/Models/DataCollection/loc/adresses_20170320.csv')
dir.create(cldatadir)
system(paste0("ls ",datadir, "|grep _data|awk '{print \"head ",datadir,"\"$0\"|grep \";\"\"}'|sh"))
system(paste0("ls ",datadir, "|grep _data|awk '{print \"head ",datadir,"\"$0\"|grep \\";\\"\"}'|sh"))
system(paste0("ls ",datadir, "|grep _data|awk '{print \"head ",datadir,"\"$0\"|grep [0-9]\"}'|sh"))
system(paste0("ls ",datadir, "|grep _data|awk '{print \"cat ",datadir,"\"$0\"|grep [0-9] > ",cldatadir,"\"$0}'|sh"))
adresses <- as.tbl(read.csv(locfile,sep=";",stringsAsFactors = FALSE,quote = ""))
library(dplyr)
adresses <- as.tbl(read.csv(locfile,sep=";",stringsAsFactors = FALSE,quote = ""))
locfile = paste0(Sys.getenv('CS_HOME'),'/EnergyPrice/Models/DataCollection/python/loc/adresses_20170320.csv')
adresses <- as.tbl(read.csv(locfile,sep=";",stringsAsFactors = FALSE,quote = ""))
cities <- readOGR(paste0(Sys.getenv("CS_HOME"),'/EnergyPrice/Data/cities/'),layer = 'zip_us_metro_simpl',stringsAsFactors = FALSE)
library(rgdal)
cities <- readOGR(paste0(Sys.getenv("CS_HOME"),'/EnergyPrice/Data/cities/'),layer = 'zip_us_metro_simpl',stringsAsFactors = FALSE)
zips <- cities@data$ZCTA5CE10
finaldir = paste0(Sys.getenv('CS_HOME'),'/EnergyPrice/Data/processed/processed_20170320/')
dir.create(finaldir)
adresses
cities <- readOGR(paste0(Sys.getenv("CS_HOME"),'/EnergyPrice/Data/cities/'),layer = 'zip_us_metro_simpl',stringsAsFactors = FALSE)
zips <- cities@data$ZCTA5CE10
states <- readOGR(paste0(Sys.getenv("CS_HOME"),'/EnergyPrice/Data/states'),layer = 'us_metro',stringsAsFactors = FALSE)
state_codes <- unique(states@data$STUSPS)
counties <- readOGR(paste0(Sys.getenv("CS_HOME"),'/EnergyPrice/Data/county/'),layer = 'county_us_metro',stringsAsFactors = FALSE)
as.tbl(counties@data)
zip_county <- as.tbl(read.csv(file=paste0(Sys.getenv("CS_HOME"),'/EnergyPrice/Data/county/zcta_county_rel_10.csv'),stringsAsFactors = FALSE))
zip_county
length(cities)
zips
zip_county
names(counties)
as.tbl(counties@data)
counties@data[counties$COUNTYFP==1,]
counties@data[counties$COUNTYFP==001,]
counties@data[counties$COUNTYFP=="1",]
counties@data[counties$COUNTYFP=="001",]
counties@data[counties$COUNTYFP=="001"&counties$STATEFP=="06",]
zip_county
zip_county[zip_county$STATE==6&zip_county==1]
zip_county[zip_county$STATE==6&zip_county==1,]
which(zip_county$STATE==6)
zip_county[zip_county$STATE==6&zip_county$COUNTY==1,]
counties@data[counties$COUNTYFP=="001"&counties$STATEFP=="06",]
zip_county[zip_county$GEOID==6001,]
zip_county <- as.tbl(read.csv(file=paste0(Sys.getenv("CS_HOME"),'/EnergyPrice/Data/county/zcta_county_rel_10.csv'),stringsAsFactors = FALSE,colClasses = rep('character',24)))
zip_county
zip_county[zip_county$GEOID=="06001",]
counties@data[counties$GEOID=="06001",]
adresses
zips
sapply(zips,nchar)
# min(sapply(zips,nchar))
min(sapply(zips,nchar))
max(sapply(zips,nchar))
length(which(adresses$code%in%zips))
adresses
adresseszips = sapply(adresses$code,function(s){substring(s,1,5)})
adresseszips
length(which(adresseszips%in%zips))
adresses$region
state_codes
length(which(adresseszips%in%zips&adresses$region%in%state_codes))
length(which(adresseszips%in%zips))
length(which(adresseszips%in%zips&adresses$region%in%state_codes))
adressesstates = sapply(adresses$region,trimws)
adressesstates
length(which(adresseszips%in%zips))
length(which(adresseszips%in%zips&adresses$region%in%state_codes))
length(state_codes)
adresses$code=adresseszips;adresses$region=adressesstates
adresses
adresses=adresses[adresseszips%in%zips&adresses$region%in%state_codes,]
adresses
adresses <- as.tbl(read.csv(locfile,sep=";",stringsAsFactors = FALSE,quote = ""))
adresses$code=adresseszips;adresses$region=adressesstates
adresses=adresses[adresses$code%in%zips&adresses$region%in%state_codes,]
adresses
library(dplyr)
library(ggplot2)
setwd(paste0(Sys.getenv('CS_HOME'),'/Misc/AnalyseGeocites/Models'))
# authors
authors <- as.tbl(read.csv('data/authors_desamb.csv',sep=";",stringsAsFactors = FALSE))
# publications
publis <- as.tbl(read.csv('data/publications.csv',sep=";",stringsAsFactors = FALSE))
# authorship
authorship <- as.tbl(read.csv('data/authorship.csv',sep=";",stringsAsFactors = FALSE))
authorship = authorship[sapply(authorship$AuteurDesamb,nchar)>0,]
publitypes = c("article_revue","article","ouvrage","chapitre","proceedings","actes_congres_national")
years = 2012:2016
publis = publis[publis$typepubli%in%publitypes,]
# nbr publis
nrow(publis)
team_authorship = left_join(authorship,authors,by=c('AuteurDesamb'='NOM'))
team_authorship = team_authorship[team_authorship$id_article%in%publis$id,]
# multi team ?
#duplicated(team_authorship[,1:2])
byteam = team_authorship%>%group_by(id_article)%>%
summarise(paris=as.numeric(sum(as.numeric("P.A.R.I.S"%in%EQUIPE))>0),
cria=as.numeric(sum(as.numeric("C.R.I.A"%in%EQUIPE))>0),
ehgo=as.numeric(sum(as.numeric("E.H.GO"%in%EQUIPE))>0),
internonly=as.numeric(prod(as.numeric(AuteurDesamb%in%authors$NOM))==1),
nbauthorsintern = sum(as.numeric(AuteurDesamb%in%authors$NOM)),
nbauthors = n(),
nbequipes = length(unique(EQUIPE[!is.na(EQUIPE)])) # ! remove NAs !
)
# add nb axes
nbaxes = sapply(publis$axe, function(s){length(strsplit(s,split=',')[[1]])})
publis$nbaxes=nbaxes
byteam=left_join(byteam,publis[,c(1,4,9)],by=c('id_article'='id'))
length(which(byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbauthors>1))
length(which(byteam$nbequipes>1&byteam$nbauthors>1))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1))
length(which(byteam$nbauthors>1))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbauthors>1&byteam$ehgo>0))
255 + 113 + 35
filepath = paste0(Sys.getenv('CS_HOME'),'/PatentsMining/Data/Japan/jp.csv')
library(dplyr)
raw <- as.tbl(read.csv(file=filepath,sep=',',stringsAsFactors = FALSE))
raw
firms = unique(raw$fno)
classes = unique(raw$IPC)
probas = matrix(0,length(firms),length(classes))
firms = as.character(unique(raw$fno))
classes = unique(raw$IPC)
probas = matrix(0,length(firms),length(classes))
rownames(probas) = firms
colnames(probas) = classes
for(i in 1:nrow(raw)){probas[raw[i,3],raw[i,4]]=probas[raw[i,3],raw[i,4]]+1}
raw[i,3]
for(i in 1:nrow(raw)){probas[raw$fno[i],raw$IPC[i]]=probas[raw$fno[i],raw$IPC[i]]+1}
raw$fno[i]
raw$IPC[i]
for(i in 1:nrow(raw)){probas[as.character(raw$fno[i]),raw$IPC[i]]=probas[as.character(raw$fno[i]),raw$IPC[i]]+1}
sum(probas)
probas <- t(apply(probas,1,function(r){r/sum(r)}))
dim(probas)
length(firms)
sum(probas)
firmproximity = probas%*%t(probas)
firmdistance = 1/sqrt(firmproximity)
which(is.na(firmdistance))
hist(c(firmdistance))
hist(c(firmdistance),breaks=10000)
firmdistance = 1/firmproximity
hist(c(firmdistance),breaks=10000)
firmdistance = 1/sqrt(firmproximity)
hist(c(firmdistance),breaks=10000)
hist(c(firmproximity),breaks=10000)
summary(c(firmproximity))
summary(c(firmproximity[firmproximity>0]))
hist(c(firmproximity[firmproximity>0]),breaks=10000)
library(igraph)
g = graph_from_adjacency_matrix(firmproximity,mode="undirected",weighted = TRUE,diag = FALSE)
g
cluster_louvain(g)
cluster_louvain(g)$sizes
cl = cluster_louvain(g)
cl
cl$vcount
cl$membership
cl$algorithm
setwd(paste0(Sys.getenv('CS_HOME'),'/PatentsMining/Data/Japan'))
dir.create('test')
outfile = 'test/graph.gml'
write_graph(graph = g,file = outfile,format = 'gml')
link_threshold = 0
which(firmproximity<link_threshold)
firmproximity[firmproximity<link_threshold]=0
link_threshold = 0.05
firmproximity[firmproximity<link_threshold]=0
g = graph_from_adjacency_matrix(firmproximity,mode="undirected",weighted = TRUE,diag = FALSE)
g
outfile = 'test/graph_theta0.05.gml'
write_graph(graph = g,file = outfile,format = 'gml')
255-42+113-33+35-13
# simplified analysis
# load data
library(dplyr)
library(ggplot2)
setwd(paste0(Sys.getenv('CS_HOME'),'/Misc/AnalyseGeocites/Models'))
# authors
authors <- as.tbl(read.csv('data/authors_desamb.csv',sep=";",stringsAsFactors = FALSE))
# publications
publis <- as.tbl(read.csv('data/publications.csv',sep=";",stringsAsFactors = FALSE))
# authorship
authorship <- as.tbl(read.csv('data/authorship.csv',sep=";",stringsAsFactors = FALSE))
authorship = authorship[sapply(authorship$AuteurDesamb,nchar)>0,]
publitypes = c("article_revue","article","ouvrage","chapitre","proceedings","actes_congres_national")
years = 2012:2016
publis = publis[publis$typepubli%in%publitypes,]
# nbr publis
nrow(publis)
team_authorship = left_join(authorship,authors,by=c('AuteurDesamb'='NOM'))
team_authorship = team_authorship[team_authorship$id_article%in%publis$id,]
# multi team ?
#duplicated(team_authorship[,1:2])
byteam = team_authorship%>%group_by(id_article)%>%
summarise(paris=as.numeric(sum(as.numeric("P.A.R.I.S"%in%EQUIPE))>0),
cria=as.numeric(sum(as.numeric("C.R.I.A"%in%EQUIPE))>0),
ehgo=as.numeric(sum(as.numeric("E.H.GO"%in%EQUIPE))>0),
internonly=as.numeric(prod(as.numeric(AuteurDesamb%in%authors$NOM))==1),
nbauthorsintern = sum(as.numeric(AuteurDesamb%in%authors$NOM)),
nbauthors = n(),
nbequipes = length(unique(EQUIPE[!is.na(EQUIPE)])) # ! remove NAs !
)
# add nb axes
nbaxes = sapply(publis$axe, function(s){length(strsplit(s,split=',')[[1]])})
publis$nbaxes=nbaxes
byteam=left_join(byteam,publis[,c(1,4,9)],by=c('id_article'='id'))
length(which(byteam$nbauthors>1&byteam$paris>0&&byteam$cria>0))
length(which(byteam$nbauthors>1&byteam$paris>0&byteam$cria>0))
length(which(byteam$nbauthors>1&byteam$paris>0&byteam$ehgo>0))
length(which(byteam$nbauthors>1&byteam$cria>0&byteam$ehgo>0))
length(which(byteam$nbauthors>1))
length(which(byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$ehgo>0))
(255 - 42) + (113 - 33) + (35 - 13) + 22 + 12 + 1
length(which(byteam$nbequipes>1&byteam$nbauthors>1))
length(which(byteam$nbequipes==1&byteam$nbauthors>1))
length(which(byteam$nbequipes==0&byteam$nbauthors>1))
length(which(byteam$nbequipes==1&byteam$nbauthors>1))
length(which(byteam$nbequipes==2&byteam$nbauthors>1))
unique(byteam$nbequipes)
unique(byteam$nbauthors)
unique(byteam$paris)
unique(byteam$cria)
unique(byteam$ehgo)
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes==2&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbauthors>1&byteam$paris>0))
min(byteam$paris+byteam$cria+byteam$ehgo)
which(byteam$paris+byteam$cria+byteam$ehgo==0)
data.frame(byteam[105,])
team_authorship[team_authorship$id_article==6522,]
unique(authors$EQUIPE)
authors[authors$EQUIPE=="",]
team_authorship
team_authorship = left_join(authorship,authors,by=c('AuteurDesamb'='NOM'))
team_authorship = team_authorship[team_authorship$id_article%in%publis$id,]
team_authorship
team_authorship = left_join(authorship,authors,by=c('AuteurDesamb'='NOM'))
team_authorship = team_authorship[team_authorship$id_article%in%publis$id&team_authorship$EQUIPE!="",]
team_authorship
team_authorship = left_join(authorship,authors,by=c('AuteurDesamb'='NOM'))
team_authorship = team_authorship[team_authorship$id_article%in%publis$id,]
team_authorship
which(is.na(team_authorship$id_article))
team_authorship = left_join(authorship,authors,by=c('AuteurDesamb'='NOM'))
team_authorship$EQUIPE[is.na(team_authorship$EQUIPE)]="EXT"
team_authorship
team_authorship = team_authorship[team_authorship$id_article%in%publis$id&team_authorship$EQUIPE!="",]
team_authorship
byteam = team_authorship%>%group_by(id_article)%>%
summarise(paris=as.numeric(sum(as.numeric("P.A.R.I.S"%in%EQUIPE))>0),
cria=as.numeric(sum(as.numeric("C.R.I.A"%in%EQUIPE))>0),
ehgo=as.numeric(sum(as.numeric("E.H.GO"%in%EQUIPE))>0),
internonly=as.numeric(prod(as.numeric(AuteurDesamb%in%authors$NOM))==1),
nbauthorsintern = sum(as.numeric(AuteurDesamb%in%authors$NOM)),
nbauthors = n(),
nbequipes = length(unique(EQUIPE[EQUIPE!="EXT"])) # ! remove NAs !
)
# add nb axes
nbaxes = sapply(publis$axe, function(s){length(strsplit(s,split=',')[[1]])})
publis$nbaxes=nbaxes
byteam=left_join(byteam,publis[,c(1,4,9)],by=c('id_article'='id'))
sum(byteam$paris)
sum(byteam$cria)
sum(byteam$ehgo)
nrow(byteam)
counts = c();cyears=c();types=c()
for(year in years){
counts=append(counts,length(which(byteam$year==year)));types=append(types,'all');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$year==year&byteam$paris>0)));types=append(types,'paris');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$year==year&byteam$cria>0)));types=append(types,'cria');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$year==year&byteam$ehgo>0)));types=append(types,'ehgo');cyears=append(cyears,year)
}
ggplot(data.frame(publis=counts,year=cyears,type=types),aes(x=year,y=publis,col=type,group=type))+geom_point()+geom_line()
length(which(byteam$nbauthors==1))/nrow(byteam)
length(which(byteam$nbauthors==1&byteam$paris>0))/sum(byteam$paris)
length(which(byteam$nbauthors==1&byteam$cria>0))/sum(byteam$cria)
length(which(byteam$nbauthors==1&byteam$ehgo>0))/sum(byteam$ehgo)
counts = c();cyears=c();types=c()
for(year in years){
counts=append(counts,length(which(byteam$nbauthors==1&byteam$year==year))/length(which(byteam$year==year)));types=append(types,'all');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbauthors==1&byteam$paris>0&byteam$year==year))/sum(byteam$paris[byteam$year==year]));types=append(types,'paris');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbauthors==1&byteam$cria>0&byteam$year==year))/sum(byteam$cria[byteam$year==year]));types=append(types,'cria');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbauthors==1&byteam$ehgo>0&byteam$year==year))/sum(byteam$ehgo[byteam$year==year]));types=append(types,'ehgo');cyears=append(cyears,year)
}
ggplot(data.frame(singleauthorrate=counts,year=cyears,type=types),aes(x=year,y=singleauthorrate,col=type,group=type))+geom_point()+geom_line()
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes==2&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbauthors>1&byteam$paris>0))
which(byteam$paris+byteam$cria+byteam$ehgo==0)
byteam[105,]
team_authorship[team_authorship$id_article==6522,]
team_authorship = left_join(authorship,authors,by=c('AuteurDesamb'='NOM'))
team_authorship$EQUIPE[is.na(team_authorship$EQUIPE)]="EXT"
team_authorship = team_authorship[team_authorship$id_article%in%publis$id&team_authorship$EQUIPE!=""&team_authorship$id_article!=6522,] # 6522 : side effect of removing desjardins ; only one with one ext left alone.
# multi team ?
#duplicated(team_authorship[,1:2])
byteam = team_authorship%>%group_by(id_article)%>%
summarise(paris=as.numeric(sum(as.numeric("P.A.R.I.S"%in%EQUIPE))>0),
cria=as.numeric(sum(as.numeric("C.R.I.A"%in%EQUIPE))>0),
ehgo=as.numeric(sum(as.numeric("E.H.GO"%in%EQUIPE))>0),
internonly=as.numeric(prod(as.numeric(AuteurDesamb%in%authors$NOM))==1),
nbauthorsintern = sum(as.numeric(AuteurDesamb%in%authors$NOM)),
nbauthors = n(),
nbequipes = length(unique(EQUIPE[EQUIPE!="EXT"])) # ! remove NAs !
)
# add nb axes
nbaxes = sapply(publis$axe, function(s){length(strsplit(s,split=',')[[1]])})
publis$nbaxes=nbaxes
byteam=left_join(byteam,publis[,c(1,4,9)],by=c('id_article'='id'))
nrow(byteam)
sum(byteam$paris)
sum(byteam$cria)
sum(byteam$ehgo)
counts = c();cyears=c();types=c()
for(year in years){
counts=append(counts,length(which(byteam$year==year)));types=append(types,'all');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$year==year&byteam$paris>0)));types=append(types,'paris');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$year==year&byteam$cria>0)));types=append(types,'cria');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$year==year&byteam$ehgo>0)));types=append(types,'ehgo');cyears=append(cyears,year)
}
ggplot(data.frame(publis=counts,year=cyears,type=types),aes(x=year,y=publis,col=type,group=type))+geom_point()+geom_line()
length(which(byteam$nbauthors==1))/nrow(byteam)
length(which(byteam$nbauthors==1&byteam$paris>0))/sum(byteam$paris)
length(which(byteam$nbauthors==1&byteam$cria>0))/sum(byteam$cria)
length(which(byteam$nbauthors==1&byteam$ehgo>0))/sum(byteam$ehgo)
counts = c();cyears=c();types=c()
for(year in years){
counts=append(counts,length(which(byteam$nbauthors==1&byteam$year==year))/length(which(byteam$year==year)));types=append(types,'all');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbauthors==1&byteam$paris>0&byteam$year==year))/sum(byteam$paris[byteam$year==year]));types=append(types,'paris');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbauthors==1&byteam$cria>0&byteam$year==year))/sum(byteam$cria[byteam$year==year]));types=append(types,'cria');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbauthors==1&byteam$ehgo>0&byteam$year==year))/sum(byteam$ehgo[byteam$year==year]));types=append(types,'ehgo');cyears=append(cyears,year)
}
ggplot(data.frame(singleauthorrate=counts,year=cyears,type=types),aes(x=year,y=singleauthorrate,col=type,group=type))+geom_point()+geom_line()
length(which(byteam$internonly!=1))/length(which(byteam$nbauthors>1))
length(which(byteam$internonly!=1&byteam$paris>0))/length(which(byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$internonly!=1&byteam$cria>0))/length(which(byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$internonly!=1&byteam$ehgo>0))/length(which(byteam$nbauthors>1&byteam$ehgo>0))
counts = c();cyears=c();types=c()
for(year in years){
counts=append(counts,length(which(byteam$internonly!=1&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$year==year)));types=append(types,'all');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$internonly!=1&byteam$paris>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$paris>0&byteam$year==year))
);types=append(types,'paris');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$internonly!=1&byteam$cria>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$cria>0&byteam$year==year))
);types=append(types,'cria');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$internonly!=1&byteam$ehgo>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$ehgo>0&byteam$year==year))
);types=append(types,'ehgo');cyears=append(cyears,year)
}
ggplot(data.frame(externalrate=counts,year=cyears,type=types),aes(x=year,y=externalrate,col=type,group=type))+geom_point()+geom_line()
# NOTE : for ehgo in 2013, 3 publis only with nbauthors > 1
rateall = byteam$nbauthorsintern[byteam$nbauthors>1]/byteam$nbauthors[byteam$nbauthors>1]
mean(rateall)
sd(rateall)
rateparis = byteam$nbauthorsintern[byteam$nbauthors>1&byteam$paris>0]/byteam$nbauthors[byteam$nbauthors>1&byteam$paris>0]
mean(rateparis)
sd(rateparis)
ratecria = byteam$nbauthorsintern[byteam$nbauthors>1&byteam$cria>0]/byteam$nbauthors[byteam$nbauthors>1&byteam$cria>0]
mean(ratecria)
sd(ratecria)
ratehgo = byteam$nbauthorsintern[byteam$nbauthors>1&byteam$ehgo>0]/byteam$nbauthors[byteam$nbauthors>1&byteam$ehgo>0]
mean(ratehgo)
sd(ratehgo)
rates = c();cyears=c();types=c()
for(year in years){
allrows=byteam$nbauthors>1&byteam$year==year
rates=append(rates,byteam$nbauthorsintern[allrows]/byteam$nbauthors[allrows]);types=append(types,rep('all',length(which(allrows))));cyears=append(cyears,rep(year,length(which(allrows))))
parisrows=byteam$nbauthors>1&byteam$year==year&byteam$paris>0
rates=append(rates,byteam$nbauthorsintern[parisrows]/byteam$nbauthors[parisrows]);types=append(types,rep('paris',length(which(parisrows))));cyears=append(cyears,rep(year,length(which(parisrows))))
criarows=byteam$nbauthors>1&byteam$year==year&byteam$cria>0
rates=append(rates,byteam$nbauthorsintern[criarows]/byteam$nbauthors[criarows]);types=append(types,rep('cria',length(which(criarows))));cyears=append(cyears,rep(year,length(which(criarows))))
ehgorows=byteam$nbauthors>1&byteam$year==year&byteam$ehgo>0
rates=append(rates,byteam$nbauthorsintern[ehgorows]/byteam$nbauthors[ehgorows]);types=append(types,rep('ehgo',length(which(ehgorows))));cyears=append(cyears,rep(year,length(which(ehgorows))))
}
ggplot(data.frame(publiinternrate=rates,year=cyears,type=types),aes(x=year,y=publiinternrate,color=type))+geom_point(size=0.5)+stat_smooth()+ylab("Publication internal rate")
length(which(byteam$nbequipes>1&byteam$nbauthors>1))/length(which(byteam$nbauthors>1))
#byteam[byteam$nbequipes==3,]
#data.frame(publis[publis$id==7216,])
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$paris>0))/length(which(byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$cria>0))/length(which(byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$ehgo>0))/length(which(byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbauthors>1))
length(which(byteam$nbequipes>1&byteam$nbauthors>1))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$paris>0))/length(which(byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$cria>0))/length(which(byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$ehgo>0))/length(which(byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes==2&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbauthors>1&byteam$paris>0))
which(byteam$paris+byteam$cria+byteam$ehgo==0)
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$paris>0))+length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$cria>0))+length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$paris>0))+
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$cria>0))+
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$ehgo>0))+
length(which(byteam$nbauthors>1&byteam$paris>0&byteam$cria>0))+
length(which(byteam$nbauthors>1&byteam$paris>0&byteam$ehgo>0))+
length(which(byteam$nbauthors>1&byteam$cria>0&byteam$ehgo>0))
counts = c();cyears=c();types=c()
for(year in years){
counts=append(counts,length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$year==year)));types=append(types,'all');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$paris>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$paris>0&byteam$year==year))
);types=append(types,'paris');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$cria>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$cria>0&byteam$year==year))
);types=append(types,'cria');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbequipes>1&byteam$nbauthors>1&byteam$ehgo>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$ehgo>0&byteam$year==year))
);types=append(types,'ehgo');cyears=append(cyears,year)
}
ggplot(data.frame(interteam=counts,year=cyears,type=types),aes(x=year,y=interteam,col=type,group=type))+geom_point()+geom_line()+ylab("Taux publis interéquipes")
# prop interaxes
length(which(byteam$nbaxes>1&byteam$nbauthors>1))/length(which(byteam$nbauthors>1))
length(which(byteam$nbaxes>1&byteam$nbauthors>1&byteam$paris>0))/length(which(byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbaxes>1&byteam$nbauthors>1&byteam$cria>0))/length(which(byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbaxes>1&byteam$nbauthors>1&byteam$ehgo>0))/length(which(byteam$nbauthors>1&byteam$ehgo>0))
counts = c();cyears=c();types=c()
for(year in years){
counts=append(counts,length(which(byteam$nbaxes>1&byteam$nbauthors>1&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$year==year)));types=append(types,'all');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbaxes>1&byteam$nbauthors>1&byteam$paris>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$paris>0&byteam$year==year))
);types=append(types,'paris');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbaxes>1&byteam$nbauthors>1&byteam$cria>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$cria>0&byteam$year==year))
);types=append(types,'cria');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$nbaxes>1&byteam$nbauthors>1&byteam$ehgo>0&byteam$year==year))/length(which(byteam$nbauthors>1&byteam$ehgo>0&byteam$year==year))
);types=append(types,'ehgo');cyears=append(cyears,year)
}
ggplot(data.frame(interaxe=counts,year=cyears,type=types),aes(x=year,y=interaxe,col=type,group=type))+geom_point()+geom_line()+ylab("Taux publis interaxes")
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$paris>0))
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$cria>0))
length(which(byteam$nbequipes==1&byteam$nbauthors>1&byteam$ehgo>0))
length(which(byteam$nbauthors>1&byteam$paris>0&byteam$cria>0))
length(which(byteam$nbauthors>1&byteam$paris>0&byteam$ehgo>0))
length(which(byteam$nbauthors>1&byteam$cria>0&byteam$ehgo>0))
team_authorship
data.frame(team_authorship)
authors
data.frame(authors)
team_authorship
byteam = team_authorship%>%group_by(id_article)%>%
summarise(paris=as.numeric(sum(as.numeric("P.A.R.I.S"%in%EQUIPE))>0),
cria=as.numeric(sum(as.numeric("C.R.I.A"%in%EQUIPE))>0),
ehgo=as.numeric(sum(as.numeric("E.H.GO"%in%EQUIPE))>0),
internonly=as.numeric(prod(as.numeric(AuteurDesamb%in%authors$NOM))==1),
nbauthorsintern = sum(as.numeric(AuteurDesamb%in%authors$NOM)),
nbauthors = n(),
nbequipes = length(unique(EQUIPE[EQUIPE!="EXT"])), # ! remove NAs !
withDoctorant = as.numeric(1%in%STATUT)
)
# add nb axes
nbaxes = sapply(publis$axe, function(s){length(strsplit(s,split=',')[[1]])})
publis$nbaxes=nbaxes
byteam=left_join(byteam,publis[,c(1,4,9)],by=c('id_article'='id'))
length(which(byteam$withDoctorant==1))/nrow(byteam)
length(which(byteam$withDoctorant==1&byteam$paris>0))/sum(byteam$paris)
length(which(byteam$withDoctorant==1&byteam$cria>0))/sum(byteam$cria)
length(which(byteam$withDoctorant==1&byteam$ehgo>0))/sum(byteam$ehgo)
counts = c();cyears=c();types=c()
for(year in years){
counts=append(counts,length(which(byteam$withDoctorant==1&byteam$year==year))/length(which(byteam$year==year)));types=append(types,'all');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$withDoctorant==1&byteam$paris>0&byteam$year==year))/sum(byteam$paris[byteam$year==year]));types=append(types,'paris');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$withDoctorant==1&byteam$cria>0&byteam$year==year))/sum(byteam$cria[byteam$year==year]));types=append(types,'cria');cyears=append(cyears,year)
counts=append(counts,length(which(byteam$withDoctorant==1&byteam$ehgo>0&byteam$year==year))/sum(byteam$ehgo[byteam$year==year]));types=append(types,'ehgo');cyears=append(cyears,year)
}
ggplot(data.frame(withdoctorantrate=counts,year=cyears,type=types),aes(x=year,y=withdoctorantrate,col=type,group=type))+geom_point()+geom_line()+ylab("Taux publis avec doctorant")
